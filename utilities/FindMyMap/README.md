# FindMyMap
Advanced Apple **Find My Offline Finding** forensic and analysis toolkit.  
This script decrypts location reports collected via OpenHaystack-compatible keys and renders them into a **fully interactive HTML map** with timeline playback, multi-tag filters, heatmaps, dark mode, and export options.

---

## üîç Features

### **Cryptography & Decryption**
- SECP224R1 ECDH shared-secret derivation  
- AES-GCM decryption of offline-finding payloads  
- Automatic key matching using `.keys` files  
- SHA-256 KDF expansion  
- P224 ephemeral key parsing and validation

### **Database Processing**
- Reads `reports.db` generated by `request_reports.py`
- Filtering:
  - Time window (`--hours`)
  - By Tag (`--tag`)
  - Last known point per tag (`--last-only`)

### **HTML Map Generation**
Generates a single-file HTML:
- Leaflet map (OSM / Satellite)
- Dark mode toggle  
- Heatmap layer  
- Time slider  
- Playback engine (prev / next / play / loop)
- GPX export  
- JSON export  
- Per-tag filtering  
- Sidebar with all points  
- Color-coded timeline (blue ‚Üí red)

---

## üìÅ Required Files

```
./reports.db
./*.keys
findmy_forensic_v3.py
```

Keys must include:

```
Private key: <base64>
Hashed adv key: <base64>
```

---

## üöÄ Usage

### **Basic usage**
```bash
python3 findmy_forensic_v3.py -H 24
```

### **Filter by specific tag**
```bash
python3 findmy_forensic_v3.py -H 48 -k aACohBi
```

### **Custom DB & auto-open output**
```bash
python3 findmy_forensic_v3.py --db /path/to/reports.db --open
```

### **Keep only last point per tag**
```bash
python3 findmy_forensic_v3.py --last-only
```

### **Custom output HTML**
```bash
python3 findmy_forensic_v3.py -o track.html
```

---

## üì¶ Output

The script generates:

```
map.html
```

This file can be opened directly or hosted on any static server.

---

## üß† Internals Summary

- Loads all `.keys` files into a dict  
- Opens SQLite DB  
- Decrypts all matching reports inside the selected time window  
- Extracts:
  - Latitude  
  - Longitude  
  - Confidence  
  - Status  
  - Timestamp  
  - Google Maps link  
- Builds `points_js` for the HTML frontend  
- Generates advanced UI logic (playback, filters, heatmaps)

---

## üïí Cron Scheduling

You can automatically refresh the map every **2 minutes** via cron:

```cron
*/2 * * * * cd /home/user/FindMyLab/FindMy/ && /home/user/FindMyLab/FindMy/.venv/bin/python3 request_reports.py >> /home/user/FindMyLab/FindMy/cron.log 2>&1 && cd FindMyMap && python3 findmymap.py -d /home/user/FindMyLab/FindMy/reports.db -p /home/user/FindMyLab/FindMy/ && mv map.html /var/www/html
```

This pipeline does:

1. Updates the `reports.db` by querying Apple servers  
2. Generates a new map  
3. Deploys it to `/var/www/html` automatically  
4. Logs output to `cron.log`

---

## ‚ö†Ô∏è Legal Notice

This tool is intended **only for lawful usage**:
- Tracking **your own devices**
- Digital forensics
- Academic research  
- OpenHaystack experimentation

Never decrypt or track devices without authorization.

---

## ‚ù§Ô∏è Credits

Based on research from:
- OpenHaystack (TU Darmstadt / SEEMOO Lab)
- Apple Find My reverse-engineering community
- Independent cryptography researchers

---

Enjoy the tool ‚Äî and contribute if you improve it!
